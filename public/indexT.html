<!DOCTYPE html>
<html>


<head>
    <link rel='stylesheet' href="./css/style.css" />
    <link rel="stylesheet" type="text/css" href="./css/tableCss.css">
    <link rel="stylesheet" type="text/css" href="./css/smallbuttonsCss.css">


</head>

<body>
    <!-- <h1>this is homepage!WelCOME!</h1> -->

    <h1>Web Bluetooth SiCom ver 1.0.0</h1>

    <h2>Connection Status</h2>

    <table border="1">
        <tr>
            <td>
                <b>Device No.</b>
            </td>
            <td>
                <b>Connected</b>
            </td>
            <td>
                <b>Device Name.</b>
            </td>

            <td>
                <b>Services Discovery Completed</b>
            </td>
            <td>
                <b>Notifications status</b>
            </td>
        </tr>
        <tr>
            <td>1</td>
            <td id="status_connected1">false</td>
            <td id="device_name1">NA</td>
            <td id="status_discovered1">false</td>
            <td id="status_notifications1">false</td>

        </tr>
    </table>

    <!-- <h2>Step.1 select profile you wanted to connect.</h2> -->

    <!-- <select id="mySelectedProfile" onchange="if (!(this.value==null)) deviceNo_1 = new webblue_phaseOne(1, this.value)"> -->
    <h2>Step.1 select a prestored profile or add your own file
        <form>
            <select id="mySelectedProfile" onchange="selectProfile(this.value)">
                <option value="" selected="selected" disabled="true">Select a profile</option>
                <option value="BBC_Microbit">Microbit</option>
                <option value="ST_BLUEST">BLUEST</option>
                <option value="ST_BLUEST_full">BLUEST_f</option>
                <option value="ST_BlueNRG">BlueNRG</option>
            </select>
            <input class="small red button" type="reset" value="reset" onclick="reinit()" />
            OR
            <input class="small green button" type="file" id="file-input" value="add" onchange="addAprofile()" />
        </form>
        <!-- Take a look at <a href=deviceNo_1.realname target="_blank">profile details</a> -->

    </h2>
    <script>
        function selectProfile(value) {
            console.log(value);
        }

        function getOwnFileRequest(file) {
            //             const xhr = new XMLHttpRequest();
            //             // xhr.open('GET', `/sign-s3?file-name=${file.name}&file-type=${file.type}`);
            //             xhr.open('GET', file);
            //             xhr.onreadystatechange = () => {
            //                 if (xhr.readyState === 4) {
            //                     if (xhr.status === 200) {

            // var filereader = new FileReader();
            // filereader.onload = (function (file) {
            //     return function (e) {
            //         console.log(e.target.result);
            //     }
            // });

            // const xhr = file.text();
            // const response = JSON.parse(xhr);
            // uploadFile(file, response.signedRequest, response.url);
            //                     }
            //                     else {
            //                         alert('Could not get signed URL.');
            //                     }
            //                 }
            //             };
            //             xhr.send();
        }

        function addAprofile() {
            console.log("adding a new Json profile!");
            const files = document.getElementById('file-input').files;
            const file = files[0];
            if (file == null) {
                return alert('No file selected.');
            }

            //multipart encoded:
            //             var formData = new FormData();
            //             xhr = new XMLHttpRequest();
            //             formData.append('file', file);
            //             xhr.open("POST", "uploads");
            //             xhr.send(formData);

            //send the file as the payload of request

            // xmlhttp.onload = function () {
            //     if (xmlhttp.status === 200) {
            //         myObj = xmlhttp.response;
            //         document.getElementById("showJson").innerHTML = JSON.stringify(myObj);
            //         myWindow = new refreshLayer(deviceNo_1.makeObjJson(myObj));
            //         myWindow.refreshSelf(deviceNo_1);
            //     } else {
            //         console.log("new work request for .json failed with respone " + xmlhttp.status + ": " + xmlhttp.statusText);
            //     }
            // }
            xhr = new XMLHttpRequest();
            xhr.open("POST", "uploads");
            xhr.setRequestHeader("Content-Type", file.type);

            xhr.onreadystatechange = function () { // Call a function when the state changes.
                if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                    // Request finished. Do processing here.
                    console.log("file saved");
                } else if (!(this.status == 200)) {
                    console.log("new work request for .json failed with respone " + xhr.status + ": " + xhr.statusText);
                }
            }

            xhr.send(file);

            // if (xhr.status == 200) {
            //     console.log("file saved");
            // }
            // else {
            //     console.log("new work request for .json failed with respone " + xhr.status + ": " + xhr.statusText);
            // }



            // console.log("file saved!");
        }



    </script>

</body>

</html>